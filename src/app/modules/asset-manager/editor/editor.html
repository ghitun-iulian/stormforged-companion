@if(state$ | async; as state){

<div class="editor-tools flex pad-s gap-s">
  <button [class.disabled]="!state.assetId" class="flex-1" (click)="createAsset()">New</button>
  <button [class.disabled]="!state.assetId" class="flex-1" (click)="duplicateAsset(state.asset)">Duplicate</button>
  <button [class.disabled]="!state.assetId" class="flex-1" (click)="deleteAsset()">Delete</button>
</div>

<div class="shape flex column justified">
  <ng-template [ngTemplateOutlet]="form.value.shape == 'hex' ? hexComponent : cardComponent"></ng-template>

  <ng-template #hexComponent>
    <hex [asset]="state.asset!" [showBack]="true" [editorPreview]="true"></hex>
  </ng-template>
  <ng-template #cardComponent>
    <card [asset]="state.asset!" [showBack]="true" [editorPreview]="true"></card>
  </ng-template>
</div>

<div class="form-container flex-1 flex column pad-s gap-m scroll-y" [formGroup]="form">

  <div class="flex gap-s">
    @for(assetShape of state.assetShapes; track $index){
    <label class="flex-1 shape-option">
      <input type="radio" formControlName="shape" [value]="assetShape" />
      {{ assetShape | titlecase }}
    </label>
    }
  </div>



  <ng-container [formGroup]="assetMetadata">
    <mat-form-field>
      <mat-label>Label</mat-label>
      <input matInput formControlName="label" />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>

    <div class="flex gap-s">
      <collection-select class="flex-1" formControlName="backImage" controllerLabel="Back image"></collection-select>
      <collection-select class="flex-1" formControlName="bgImage" controllerLabel="Background"></collection-select>
    </div>

    <div class="flex gap-s">
      <mat-form-field class="flex-1">
        <mat-label>Print Quantity</mat-label>
        <input matInput formControlName="printQty" type="number" min="0" />
      </mat-form-field>

      <mat-form-field class="flex-1">
        <mat-label>Size</mat-label>
        <input matInput formControlName="size" type="number" min="0" />
        <span matSuffix>mm</span>
      </mat-form-field>
    </div>

  </ng-container>

  <mat-form-field style="border-bottom: var(--border); padding-bottom: var(--m);">
    <mat-label>Asset Type</mat-label>
    <mat-select formControlName="type">
      @for(assetType of state.asset.shape == 'hex' ? state.hexDataTypes : state.cardDataTypes; track $index){
      <mat-option [value]="assetType">{{ assetType }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  @switch(`${state.asset.shape}-${state.asset.type}`) {
  @case ('card-resource') { <card-resource-form class="flex column" formControlName="data"></card-resource-form>}
  @case ('card-event') { <card-event-form class="flex column" formControlName="data"></card-event-form>}
  @case ('card-storm') { <card-storm-form class="flex column" formControlName="data"></card-storm-form>}
  @case ('card-relic') { <card-relic-form class="flex column" formControlName="data"></card-relic-form>}

  @case ('hex-resource') {<hex-resource-form class="flex column" formControlName="data"></hex-resource-form>}
  @case ('hex-platform') { <hex-platform-form class="flex column" formControlName="data"></hex-platform-form> }
  @case ('hex-location') { <hex-location-form class="flex column" formControlName="data"></hex-location-form> }
  @case ('hex-exploration') { <hex-exploration-form class="flex column" formControlName="data"></hex-exploration-form> }
  @case ('hex-tracker') { <hex-tracker-form class="flex column" formControlName="data"></hex-tracker-form> }
  }

</div>

}